riot.tag2("ipat",'<header class="Header_Area fc"> <div class="Header_Inner"> <h1> <a href="{args.www_netkeiba}?rf=logo" title="netkeiba.com"> <img riot-src="{args.cdn_www}/style/netkeiba.ja/image/common/netkeiba_logo01.png" alt="netkeiba.com"> </a> <img riot-src="{args.cdn_race_url}/common/img/ipat_head_title.png" alt="netkeiba.com"> </h1> <div class="Ipat_HederMenu"> <ul class="UserMyMenu fc"> <li> <a href="../shushi/ipat_history.html" class="btn"> My収支 </a> </li> <li> <a href="javascript:void(0)" id="ipat_dialog_inquiry" onclick="{act_jra_ipat_login.bind(this, \'inquiry\')}" class="btn"> <img disabled="true" riot-src="{args.cdn_race_url}/common/img/icon/icon_ipat01.png" alt="IPAT">投票照会 </a> </li> <li if="{ipat_syusai != \'abroad\'}"> <a href="javascript:void(0)" id="ipat_dialog_menu" onclick="{act_jra_ipat_login.bind(this, \'menu\')}" class="btn"> <img disabled="true" riot-src="{args.cdn_race_url}/common/img/icon/icon_ipat01.png" alt="IPAT">入出金 </a> </li> </ul> </div> </div> </header> <div class="IpatVote" if="{is_show}"> <section class="Ipat_Head"> <div class="Wrap_inner"> <div class="RaceList_NameBox"> <div class="RaceList_Item01"> <span class="RaceNum">{sprintf(⁗%d⁗,cur_race_id.substr(10,2))}R</span> </div> <div class="RaceList_Item02"> <div class="RaceName"> {cur_race_name} <span if="{\'701\'!= cur_race[\'jyoken_cd\'] && \'703\'!= cur_race[\'jyoken_cd\']}"> <span class="Icon_GradeType Icon_GradeType{edit_grade_icon()} Icon_GradePos01"></span> </span> </div> <div class="RaceData01"> {cur_race[\'kaisai_date_view\']}({cur_race[\'youbi\']}) &nbsp; {cur_race[\'jyo\']} &nbsp; {cur_race[\'start\']} &nbsp; {cur_race[\'kyori\']}({mawari[ cur_race[\'track_kubun\'] ]}) &nbsp; {cur_race[\'tosu\']}頭 <span if="{\'\' != cur_race[\'tenko_cd\']}"> <span class="Icon_Weather Weather{tenko_icon[cur_race[\'tenko_cd\']]}"> </span> <span class="Item04"> {cur_race[\'shiba_baba\']} {cur_race[\'dirt_baba\']} </span> </span> </div> </div> </div> </div> </section> <section class="BetType_Select"> <div class="Wrap_inner"> <div class="select_col" if="{1 == selection_type}"> <fieldset disabled="{(2 <= phase) ? false : true}"> <div class="dropdown" style="white-space: nowrap"> <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false"> <span if="{(0 > cur_shikibetu) ? true: false}">式別</span> <span if="{(0 <= cur_shikibetu) ? true: false}">{shikibetu[cur_shikibetu]}</span> <span class="caret"></span> </button> <ul class="dropdown-menu" role="menu"> <li role="presentation" each="{label,sno in shikibetu}"> <a href="javascript:void(0)" onclick="{act_shikibetu.bind(this, sno)}">{label}</a> </li> </ul> </div> </fieldset> <fieldset disabled="{(3 <= phase) ? false : true}"> <div class="dropdown" style="white-space: nowrap"> <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false"> <span if="{(0 > cur_houshiki) ? true : false}">方式</span> <span if="{(0 <= cur_houshiki) ? true : false}"> {houshiki[cur_shikibetu][cur_houshiki]} </span> <span class="caret"></span> </button> <ul class="dropdown-menu" role="menu"> <li role="presentation" each="{label,hno in houshiki[cur_shikibetu]}"> <a href="javascript:void(0)" onclick="{act_houshiki.bind(this, hno)}">{label}</a> </li> </ul> </div> </fieldset> <div class="select_col_item MultiCheck" style="white-space: nowrap" if="{multi_attr}"> <label> <input type="checkbox" onclick="{act_multi.bind(this)}" checked="{(multi) ? \'checked\' : \'\'}"> マルチ </label> </div> </div> <fieldset disabled="{(2 <= phase) ? false : true}" if="{2 == selection_type}"> <dl class="shikibetu"> <dt>券種選択</dt> <dd class="{(sno == cur_shikibetu) ? \'Active\' : \'\'}" each="{label,sno in shikibetu}" onclick="{list_mark_check}"> <a href="javascript:void(0)" onclick="{act_shikibetu.bind(this, sno)}">{label}</a> </dd> </dl> <dl class="houshiki" if="{(0 < cur_shikibetu)}"> <dt>方式選択</dt> <dd class="{(hno1 == cur_houshiki_1) ? \'Active\' : \'\'}" each="{label1,hno1 in houshiki_button1}" if="{edit_houshiki_button1_disable(hno1)}"> <a href="javascript:void(0)" onclick="{act_houshiki_1.bind(this, hno1)}">{label1}</a> </li> </dl> <dl class="houshiki" if="{(\'3\' == cur_houshiki_1 && \'6\' <= cur_shikibetu)}"> <dt>ながし指定</dt> <dd class="{(hno2 == cur_houshiki) ? \'Active\' : \'\'}" each="{label2,hno2 in houshiki_button2[cur_shikibetu]}"> <a href="javascript:void(0)" onclick="{act_houshiki.bind(this, hno2)}">{label2}</a> </dd> <dd class="Multi_Select" if="{multi_attr}"> <input type="checkbox" onclick="{act_multi.bind(this)}" checked="{(multi) ? \'checked\' : \'\'}" id="MultiCheck"> <label for="MultiCheck">マルチ</label> </dd> </dl> </fieldset> </div> </section> <section class="Ipat_Body fc"> <div class="Body_inner"> <section class="Kaime_select"> <div if="{(\'3\' != cur_shikibetu)}"> <table class="IpatTable" summary="" cellspacing="1" cellpadding="0"> <thead> <tr class="Header"> <th if="{ipat_syusai == \'abroad\'}" class="WakuTh">ゲ<br>|<br>ト</th> <th if="{ipat_syusai != \'abroad\'}" class="WakuTh">枠</th> <th class="UmaNumTh">馬<br>番</th> <th class="ShirushiTh">印</th> <th class="">馬名</th> <th each="{tmp,rix in data_number_v[0]}" if="{edit_show_column(rix, \'in\')}" class="ActionBtn"> {edit_label(rix)} <virtual if="{houshiki_attr[cur_shikibetu + cur_houshiki][\'check\'][rix] == 0}"> <virtual if="{!btn_func_stat[\'all\'][rix]}"> <input type="checkbox" id="btn_sel_{rix}" class="All_Action" checked="{btn_func_stat[\'all\'][rix] ? true : false}" disabled="{btn_func_stat[\'all\'][rix] ? true : false}" onclick="{act_ext_func.bind(this, \'all\', rix)}"> <label for="btn_sel_{rix}" class="All_Action_Button">全通り</label> </virtual> <virtual if="{btn_func_stat[\'all\'][rix]}"> <input type="checkbox" id="btn_clr_{rix}" class="Cancel_Action" onclick="{act_ext_func.bind(this, \'clear\', rix)}"> <label class="Cancel_Action_Button" for="btn_clr_{rix}">クリア</label> </virtual> <virtual if="{!btn_func_stat[\'mark\'][rix]}"> <input type="checkbox" id="btn_mymark_{rix}" class="Mark_Action" checked="{btn_func_stat[\'mark\'][rix] ? true : false}" disabled="{btn_func_stat[\'mark\'][rix] ? true : false}" onclick="{act_ext_func.bind(this, \'mark\', rix)}"> <label for="btn_mymark_{rix}" class="Mark_Action_Button">印</label> </virtual> <virtual if="{btn_func_stat[\'mark\'][rix]}"> <input type="checkbox" id="btn_clr_{rix}" class="Cancel_Action" onclick="{act_ext_func.bind(this, \'clear\', rix)}"> <label class="Cancel_Action_Button" for="btn_clr_{rix}">クリア</label> </virtual> </virtual> </th> <th class="Odds">オッズ</th> <th class="Popular">人気</th> </tr> </thead> <tbody> <tr class="HorseList" id="tr_{uix+ 1}" each="{ary_row,uix in data_number_v}"> <td class="Waku{(cur_race.jyo_cd.substr(0,1) >= \'A\') ? 1 : race_horse[uix + 1][\'wakuban\']}">{race_horse[uix + 1][\'wakuban\']}</td> <td class="">{race_horse[uix + 1][\'umaban\']}</td> <td class=""> <span if="{my_mark[race_horse[uix + 1][\'seq\']]}" class="MarkIcon Mark{my_mark[race_horse[uix + 1][\'seq\']]}"></span> </td> <td class="Horse">{race_horse[uix + 1][\'horse_name\']}</td> <td each="{row,rix in ary_row}" class="Horse_Select" if="{edit_show_column(rix, \'in\')}"> <div> <input if="{race_horse[uix + 1][\'ijyo\'] != \'除外\' && race_horse[uix + 1][\'ijyo\'] != \'取消\'}" type="{edit_show_input_type(rix)}" class="HorseCheck_Select" id="uc-{rix}-{uix + 1}" name="" value="1" checked="{edit_number_active(rix,uix + 1) ? true : false}" disabled="{edit_number_disable(rix,uix + 1) ? true : false}" onclick="{act_number.bind(this, rix, uix + 1)}"> <label for="uc-{rix}-{uix + 1}" class="Check01Btn_Off"></label> </div> </td> <td if="{( ipat_syusai == \'nar\' || ipat_syusai == \'abroad\') && race_horse[uix + 1][\'ijyo\'] != \'除外\' && race_horse[uix + 1][\'ijyo\'] != \'取消\'}" class="Odds">{race_horse[uix + 1][\'odds\']}</td> <td if="{ipat_syusai == \'jra\' && race_horse[uix + 1][\'ijyo\'] != \'除外\' && race_horse[uix + 1][\'ijyo\'] != \'取消\'}" class="Odds" id="odds-1_{race_horse[uix + 1][\'umaban\'] ? zeroPadding(race_horse[uix + 1][\'umaban\'], 2) : race_horse[uix + 1][\'seq\']}">---.-</td> <td if="{race_horse[uix + 1][\'ijyo\'] == \'除外\' || race_horse[uix + 1][\'ijyo\'] == \'取消\'}">{race_horse[uix + 1][\'ijyo\']}</td> <td if="{( ipat_syusai == \'nar\' || ipat_syusai == \'abroad\') && race_horse[uix + 1][\'ijyo\'] != \'除外\' && race_horse[uix + 1][\'ijyo\'] != \'取消\'}" class="">{race_horse[uix + 1][\'ninki\']}</td> <td if="{ipat_syusai == \'jra\' && race_horse[uix + 1][\'ijyo\'] != \'除外\' && race_horse[uix + 1][\'ijyo\'] != \'取消\'}" class="" id="ninki-1_{race_horse[uix + 1][\'umaban\'] ? zeroPadding(race_horse[uix + 1][\'umaban\'], 2) : race_horse[uix + 1][\'seq\']}"></td> <td if="{race_horse[uix + 1][\'ijyo\'] == \'除外\' || race_horse[uix + 1][\'ijyo\'] == \'取消\'}">--</td> </tr> </tbody> </table> </div> <div if="{(\'3\' == cur_shikibetu)}"> <table class="IpatTable"> <thead> <tr class="Header"> <th if="{ipat_syusai == \'abroad\'}" class="">ゲ|ト</th> <th if="{ipat_syusai != \'abroad\'}" class="">枠番</th> <th class="">馬番</th> <th class="">印</th> <th>馬名</th> <th each="{tmp,rix in data_number_v[0]}" if="{edit_show_column(rix, \'in\')}" class="ActionBtn">{edit_label(rix)} <virtual if="{cur_houshiki != 0 && houshiki_attr[cur_shikibetu + cur_houshiki][\'check\'][rix] == 0}"> <virtual if="{!btn_func_stat[\'all\'][rix]}"> <input type="checkbox" id="btn_sel_{rix}" class="All_Action" checked="{btn_func_stat[\'all\'][rix] ? true : false}" disabled="{btn_func_stat[\'all\'][rix] ? true : false}" onclick="{act_ext_func.bind(this, \'all\', rix)}"> <label for="btn_sel_{rix}" class="All_Action_Button">全通り</label> </virtual> <virtual if="{btn_func_stat[\'all\'][rix]}"> <input type="checkbox" id="btn_clr_{rix}" class="Cancel_Action" onclick="{act_ext_func.bind(this, \'clear\', rix)}"> <label class="Cancel_Action_Button" for="btn_clr_{rix}">クリア</label> </virtual> <virtual if="{!btn_func_stat[\'mark\'][rix]}"> <input type="checkbox" id="btn_mymark_{rix}" class="Mark_Action" checked="{btn_func_stat[\'mark\'][rix] ? true : false}" disabled="{btn_func_stat[\'mark\'][rix] ? true : false}" onclick="{act_ext_func.bind(this, \'mark\', rix)}"> <label for="btn_mymark_{rix}" class="Mark_Action_Button">印</label> </virtual> <virtual if="{btn_func_stat[\'mark\'][rix]}"> <input type="checkbox" id="btn_clr_{rix}" class="Cancel_Action" onclick="{act_ext_func.bind(this, \'clear\', rix)}"> <label class="Cancel_Action_Button" for="btn_clr_{rix}">クリア</label> </virtual> </virtual> </th> </tr> </thead> <tbody> <tr id="tr_{uix + 1}" each="{ary_row,uix in data_number_v}"> <td class="Waku{uix + 1}"> {uix + 1} </td> <td class=""> <div each="{wh,w in waku_horse[uix + 1]}"> {wh[\'umaban\']} </div> </td> <td class=""> <div each="{wh,w in waku_horse[uix + 1]}"> <span if="{my_mark[wh[\'seq\']]}" class="MarkIcon Mark{my_mark[wh[\'seq\']]}"></span> </div> </td> <td class="Horse"> <div each="{wh,w in waku_horse[uix + 1]}"> {wh[\'horse_name\']} </div> </td> <td each="{row,rix in ary_row}" if="{edit_show_column(rix, \'in\')}" class="Horse_Select"> <div> <input type="{edit_show_input_type(rix)}" class="HorseCheck_Select" id="uc-{rix}-{uix + 1}" name="" value="1" checked="{edit_number_active(rix,uix + 1) ? true : false}" disabled="{edit_number_disable_waku(rix,uix + 1) ? true : false}" onclick="{act_number.bind(this, rix, uix + 1)}"> <label for="uc-{rix}-{uix + 1}" class="Check01Btn_Off"></label> </div> <tr class="col_label"> </td> </tr> </tbody> </table> </div> </section> <section class="Kaime_Detail"> <div class="Selected_Block"> <div class="Title"> <span id="select_type">{shikibetu[cur_shikibetu]} {houshiki_button1[cur_houshiki]}</span> </div> <div class="Inner fc"> <div class="Kumiawase"> <span id="kumiawase_kensu">{bet_count}</span><span class="Txt01">点</span> </div> <div class="MoneyInputArea"> <div class="MoneyInputBox"> <div class="Money"> <span if="{is_distribution}">予算:</span> <span if="{!is_distribution}">金額:</span> <input name="money" min="1" max="10000" pattern="[0-9]*" style="width:80px;text-align: right;" riot-value="{edit_check_bet_money(bet_money)}" oninput="{act_input_money.bind(this)}" type="{\'number\'}"> 00円 </div> <div class="AddBtn"> <button class="{disp_btn_disabled()}" onclick="{act_add_bet.bind(this)}">追加</button> </div> <div class="TenKeyOpen"> <div class="TenKeyArea" if="{is_keypad}"> <div class="TenKeyClose"> <button class="btn" onclick="{act_keypad.bind(this, \'close\')}">閉じる</button> </div> <div class="TenKeyInputVal"> <span class="ValBox">{disp_keypad_val}</span><span class="AmountTxt">00円</span> </div> <ul class="TenKeyNumBtnList fc"> <li> <button class="btn" onclick="{act_keypad.bind(this, \'7\')}" accesskey="7">7</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'8\')}" accesskey="8">8</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'9\')}" accesskey="9">9</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'4\')}" accesskey="4">4</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'5\')}" accesskey="5">5</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'6\')}" accesskey="6">6</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'1\')}" accesskey="1">1</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'2\')}" accesskey="2">2</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'3\')}" accesskey="3">3</button> </li> <li> <button class="btn" onclick="{act_keypad.bind(this, \'0\')}" accesskey="0">0</button> </li> <li class="ClearBtn"> <button class="btn" onclick="{act_keypad.bind(this, \'clear\')}" accesskey="c">クリア</button> </li> </ul> <div class="TenKeyInputSet"> <button class="btn" onclick="{act_keypad.bind(this, \'set\')}" accesskey="s">セット</button> </div> </div> <button class="btn TenKeyOpenBtn" onclick="{act_show_keypad.bind(this)}"><img riot-src="{args.cdn_race_url}/ipat/common/img/icon/icon_tenkey_02.png" alt="金額セット用テンキー"></button> </div> </div> <div class="AllotmentBox"> <input type="checkbox" name="distribution" onclick="{act_distribution.bind(this)}" id="AllotmentCheck" checked="{is_distribution ? true : false}"> <label for="AllotmentCheck">資金配分</label> </div> </div> </div> </div> <div class="Kaime_block"> <div class="Title"> 投票内容 </div> <virtual each="{bet,bix in bet_view}" if="{2 == selection_type}"> <div class="Kaime_wrap"> <div class="{(bet_select[bix * 1000]) ? \'Kaime_Table color\' : \'Kaime_Table\'}"> <div class="kaime_open" if="{bet.comb}" onclick="{act_kaime_select.bind(this, bix, -1)}"> <input class="disp_nonex" id="p-chk_open_{bix}" type="checkbox" onclick="{act_kaime_open.bind(this, bix)}"> <label for="p-chk_open_{bix}"> <span if="{! bet.open}">＋</span> <span if="{bet.open}" class="Open">ー</span> </label> </div> <div class="kaime_view" id="select_kumiawase" onclick="{act_kaime_select.bind(this, bix, -1)}"> <span>{bet.shikibetu_name}&nbsp;{bet.houshiki_name}&nbsp;{bet.is_multi ? \'マルチ\': \'\'}</span> <table> <tbody> <tr if="{\'0\' == bet.houshiki}"> <td class="Num"> <span class="UmaBan" if="{\'\' != bet.kaime1}">{bet.kaime1}</span> <virtual if="{\'\' != bet.kaime2}"><span class="{edit_kaime_class(bet.shikibetu)}"></span><span class="UmaBan">{bet.kaime2}</span></virtual> <virtual if="{\'\' != bet.kaime3}"><span class="{edit_kaime_class(bet.shikibetu)}"></span><span class="UmaBan">{bet.kaime3}</span></virtual> </td> </tr> <tr if="{\'0\' != bet.houshiki}" each="{row,ik in bet.ary_kaime}"> <th> <div if="{\'2\' != bet.houshiki}"> {edit_kaime_label(bet.shikibetu, bet.houshiki, ik)} </div> </th> <td class="Num"> <span class="UmaBan" each="{uno in row}">{uno}</span> </td> </tr> </tbody> </table> </div> <div class="pay" onclick="{act_kaime_select.bind(this, bix, -1)}"> <ul> <li><span class="kumiawase_kensu"><em>{bet.bet_count}</em>点</span></li> <li><span class="Txt01">各<input name="" min="1" max="10000" pattern="[0-9]*" style="width:80px;text-align: right;" type="text" onchange="{act_change_money_single.bind(this)}" riot-value="{(bet.bet_money < 0) ? \'\' : bet.bet_money / 100}">00円</span></li> <li><span class="Txt01">計{number_format(bet.bet_money_total)}円</span></li> </ul> <br> <span if="{\'0\' == bet.houshiki && !is_yoso_odds}"> 想定払戻金<br> <span class="Total">{(\'0\' == bet.houshiki) ? number_format(bet.payback)+\'円\' : \'\'}</span> 損益<br> <span class="{edit_payment_diff(bet.payback, total_bet_money)}">{number_format(bet.payback - total_bet_money)}円</span> </span> </div> <div class="Select" onclick="{act_kaime_select.bind(this, bix, -1)}"> <input class="BuyCheck_Select disp_none" type="checkbox" id="p-chk_sel_{bix}" value="1" checked="{(bet_select[bix * 1000]) ? true : false}" onclick="{act_kaime_select.bind(this, bix, -1)}"> <label for="p-chk_sel_{bix}" class="Check01Btn_Off"></label> </div> </div> <div class="Kaime_Detail_wrap"> <table class="Kaime_detail_table" if="{bet.open}"> <thead> <tr> <th class="kaime_view">買い目</th> <th class="pay">購入金額 <div class="PayBack"> <span>想定払戻金</span> <span>損益</span> </div> </th> <th width="58">選択</th> </tr> </thead> <tbody> <tr each="{comb,bcix in bet.comb}" class="{(bet_select[bix * 1000 + bcix + 1]) ? \'bg-danger\' : \'\'}" onclick="{act_kaime_select.bind(this, bix, bcix + 1)}"> <td class="Apart"> <ul class="fc"> <li each="{row in edit_combination(comb, bet.shikibetu, bet.houshiki)}"> <span class="UmaBan">{row.no}</span> <span class="{(1 == row.type) ? \'Hyphen\' : \'Kaime_Arrow\'}" if="{row.type > 0}"></span> </li> </ul> </td> <td class="Pay"> <input name="" min="1" max="10000" pattern="[0-9]*" style="width:80px;text-align: right;" type="text" riot-value="{number_format(bet.bet_money)}"> 円 <div class="PayBack"> <span class="Payout">{(\'0\' != bet.houshiki) ? number_format(bet.payback[bcix])+\'円\' : \'\'}</span> <span class="{edit_payment_diff(bet.payback[bcix], total_bet_money)}">{(\'0\' != bet.houshiki) ? number_format(bet.payback[bcix] - total_bet_money)+\'円\' : \'\'}</span> </div> </td> <td class="Select"> <input class="BuyCheck_Select disp_none" type="checkbox" id="p-chk_sel_comb_{bcix}" value="1" checked="{(bet_select[bix * 1000 + bcix + 1]) ? true : false}" onclick="{act_kaime_select.bind(this, bix, bcix + 1)}"> <label for="p-chk_sel_comb_{bcix}" class="Check01Btn_Off"> </label> </td> </tr> </tbody> </table> </div> </div> </virtual> <table class="RaceOdds_Result_Table02" if="{bet_view.length > 0}"> <tbody class="list"> <tr class="ActionBtn"> <td class="Txt"><div><span>すべてを選択/クリア</span></div></td> <td class="Select"> <input class="All_Action" id="p-chk_all" type="checkbox" value="1" onclick="{act_kaime_select_all.bind(this)}" checked="{bet_select_all ? true : false}"> <label for="p-chk_all"></label> </td> </tr> </tbody> </table> <dl class="BetPanelTotal"> <dt>合計</dt> <dd>{number_format(total_bet_money)}円</dd> </dl> </div> <br> <div class="BetPanelArea" if="{1 == selection_type}"> <div class="Ipat_Contents"> <ul class="BetPanelList"> <li each="{bet,bix in bet_view}"> <div class="BetPanelOpenBtn"> <span if="{bet[\'comb\' ]}"> <a href="javascript:void(0)" onclick="{act_kaime_open.bind(this, bix)}"> <span if="{! bet.open}">＋</span> <span if="{bet.open}">－</span> </a> </span> <span if="{! bet[\'comb\' ]}">&nbsp;</span> </div> <div class="{(bet_select[bix * 1000]) ? \'bg-danger\' : \'BetPanel_Item\'}" onclick="{act_kaime_select.bind(this, bix, -1)}"> <ul class="BetInfo"> <li class="BetInfo_Item BetInfo_Item01">{bet.race_name}</li> <li class="BetInfo_Item fwB"> {bet.shikibetu_name}&nbsp;{bet.houshiki_name}&nbsp;{bet.is_multi ? \'マルチ\': \'\'} </li> <li class="BetInfo_Item fwB"> {bet.kumi_name} </li> <li class="BetInfo_Item">{bet.bet_count}組&nbsp;各{number_format(bet.bet_money)}円</li> <li class="BetInfo_Item fwB">計{number_format(bet.bet_money_total)}円</li> <li class="BetInfo_Item" if="{\'0\'==bet.houshiki}"> 想定払戻&nbsp;{(\'0\' == bet.houshiki) ? number_format(bet.payback)+\'円\' : \'\'} </li> </ul> </div> <ul class="BetPanelOpenList" if="{bet[\'open\']}"> <li each="{comb,bcix in bet.comb}"> <div class="{(bet_select[bix * 1000 + bcix + 1]) ? \'bg-danger\' : \'BetPanel_Item\'}" onclick="{act_kaime_select.bind(this, bix, bcix + 1)}"> <ul class="BetInfo"> <li class="BetInfo_Item fwB">{comb}&nbsp;&nbsp;{bet.bet_money}円</li> <li class="BetInfo_Item"> 想定払戻&nbsp;{(\'0\' != bet.houshiki) ? number_format(bet.payback[bcix])+\'円\' : \'\'} </li> </ul> </div> </li> </ul> </li> </ul> <dl class="BetPanelTotal"> <dt class="Label">合計</dt><dd>{number_format(total_bet_money)}円</dd> </dl> </div> </div> <div class="ipat_menu"> <button if="{type_dropdown}" class="btn Common_Btn" onclick="{act_kaime_select_all.bind(this)}">全て選択</button> <button class="btn Common_Btn" data-toggle="modal" data-backdrop="false" onclick="{act_check_bet_select.bind(this)}">金額変更</button> <button class="btn Common_Btn" onclick="{act_kaime_delete.bind(this)}">削除</button> </div> <div class="ipat_Set_Menu"> <button id="ipat_dialog" class="SubmitBtn" onclick="{act_jra_ipat_login.bind(this, \'bet\')}">IPAT投票</button> </div> </section> </div> </section> </div> <div if="{is_change_money}" class="BatchInput_Form"> <div class="BatchInput_Header"> <div class="Title">金額入力</div> <div class="BatchInputValue fc"> <input min="1" max="10000" pattern="[0-9]*" placeholder="--" class="InputMoney" name="bet_money" id="bet_money" value="" oninput="{act_input_money.bind(this)}" type="number"> <div>00<span>円</span></div> </div> </div> <div class="Type_Btn"> <ul> <li><button type="submit" class="Btn SubmitBtn01" onclick="{act_change_money.bind(this, true)}">変更する</button></li> <li><button type="submit" class="Btn CanselBtn01" onclick="{act_change_money.bind(this, false)}">キャンセル</button></li> </ul> </div> </div> <div if="{is_change_money}" class="IpatBetOverlay" riot-style="height: {height}px; width: {width}px"></div>',"","",function(e){"use strict";var t=this;t.args=t.opts,t.debug=!0,t.param=null,t.debug&&console.log("sel.args: %O",t.args),t.selection_type=2,t.phase=0,t.houshiki_attr={10:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},20:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},30:{in:[1,1,0],all:[0,0,0],check:["radio&nodupp","radio&nodupp",0],label:["枠1","枠2","--"]},31:{in:[1,1,0],all:[1,1,0],check:[0,0,0],label:["枠1","枠2","--"]},32:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},33:{in:[1,1,0],all:[0,1,0],check:["radio",0,0],label:["軸","相手","--"]},40:{in:[1,0,0],all:[0,0,0],check:["max:2",0,0],label:["--","--","--"]},41:{in:[1,1,0],all:[1,1,0],check:[0,0,0],label:["馬1","馬2","--"]},42:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},43:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["軸","相手","--"]},50:{in:[1,0,0],all:[0,0,0],check:["max:2",0,0],label:["--","--","--"]},51:{in:[1,1,0],all:[1,1,0],check:[0,0,0],label:["馬1","馬2","--"]},52:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},53:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["軸","相手","--"]},60:{in:[1,1,0],all:[0,0,0],check:["radio&nodupp","radio&nodupp",0],label:["1着","2着","--"]},61:{in:[1,1,0],all:[1,1,0],check:[0,0,0],label:["軸","相手","--"]},62:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},63:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["1着軸","相手","--"]},64:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["2着軸","相手","--"]},70:{in:[1,1,1],all:[0,0,0],check:["radio&nodupp","radio&nodupp","radio&nodupp"],label:["馬1","馬2","馬3"]},71:{in:[1,1,1],all:[1,1,1],check:[0,0,0],label:["馬1","馬2","馬3"]},72:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},73:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["軸","相手","--"]},76:{in:[1,1,1],all:[0,0,1],check:["radio&nodupp","radio&nodupp",0],label:["軸1","軸2","相手"]},80:{in:[1,1,1],all:[0,0,0],check:["radio&nodupp","radio&nodupp","radio&nodupp"],label:["1着 ","2着 ","3着"]},81:{in:[1,1,1],all:[1,1,1],check:[0,0,0],label:["1着 ","2着 ","3着"]},82:{in:[1,0,0],all:[1,0,0],check:[0,0,0],label:["--","--","--"]},83:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["1着軸","相手","--"]},84:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["2着軸","相手","--"]},85:{in:[1,1,0],all:[0,1,0],check:["radio&nodupp",0,0],label:["3着軸","相手","--"]},86:{in:[1,1,1],all:[0,0,1],check:["radio&nodupp","radio&nodupp",0],label:["1着","2着","相手"]},87:{in:[1,1,1],all:[0,0,1],check:["radio&nodupp","radio&nodupp",0],label:["1着","3着","相手"]},88:{in:[1,1,1],all:[0,0,1],check:["radio&nodupp","radio&nodupp",0],label:["2着","3着","相手"]}},t.houshiki_check={10:{chk:["gt:1"]},20:{chk:["gt:1"]},30:{chk:["eq:1","eq:1"]},31:{chk:["gt:1","gt:1"]},32:{chk:["gt:2"]},33:{chk:["eq:1","gt:1"]},40:{chk:["eq:2"]},41:{chk:["gt:1","gt:1"]},42:{chk:["gt:2"]},43:{chk:["eq:1","gt:1"]},50:{chk:["eq:2"]},51:{chk:["gt:1","gt:1"]},52:{chk:["gt:2"]},53:{chk:["eq:1","gt:1"]},60:{chk:["eq:1","eq:1"]},61:{chk:["gt:1","gt:1"]},62:{chk:["gt:2"]},63:{chk:["eq:1","gt:1"]},64:{chk:["eq:1","gt:1"]},70:{chk:["eq:1","eq:1","eq:1"]},71:{chk:["gt:1","gt:1","gt:1"]},72:{chk:["gt:3"]},73:{chk:["eq:1","gt:1"]},76:{chk:["eq:1","eq:1","gt:1"]},80:{chk:["eq:1","eq:1","eq:1"]},81:{chk:["gt:1","gt:1","gt:1"]},82:{chk:["gt:3"]},83:{chk:["eq:1","gt:2"]},84:{chk:["eq:1","gt:2"]},85:{chk:["eq:1","gt:2"]},86:{chk:["eq:1","eq:1","gt:1"]},87:{chk:["eq:1","eq:1","gt:1"]},88:{chk:["eq:1","eq:1","gt:1"]}},t.houshiki_button1={0:"通常",3:"ながし",2:"ボックス",1:"フォーメーション"},t.houshiki_button2={6:{3:"1着",4:"2着"},7:{3:"軸1",6:"軸2"},8:{3:"1着",4:"2着",5:"3着",6:"1,2着",7:"1,3着",8:"2,3着"}},t.kaisai_list={},t.race_list={},t.cur_jyo_cd="",t.cur_jyo_name="",t.cur_race_id="",t.cur_race_name="",t.cur_race={},t.mawari={1:"左",2:"右",3:"直"},t.tenko_icon={1:"01",2:"02",3:"03",4:"03",5:"04",6:"04"},t.grade_icon={A999:"1",B999:"2",C999:"3",D999:"4",F999:"10",G999:"11",H999:"12",999:"5","016":"6","010":"7","005":"9","3win":"16","2win":"17","1win":"18",701:"",703:""},t.shikibetu={},t.cur_shikibetu=-1,t.houshiki={},t.cur_houshiki=-1,t.data_number=[],t.data_number_v=[],t.btn_func=[],t.btn_func_stat={all:[],mark:[]},t.mulit_attr=!1,t.mulit=!1,t.btn_uno={},t.btn_uno_disable={},t.max_uma=0,t.max_waku=0,t.bet_money=-1,t.race={},t.race_id="",t.race_horse={},t.waku_horse={},t.bet_view=[],t.bet_select={},t.bet_select_all=!1,t.bet_count=0,t.isam_domain="",t.my_mark={},t.total_bet_money=0,t.odds={},t.ext_param={},t.is_betting="",t.is_yoso_odds=!1,t.child_close=!1,t.is_show=!1,t.is_change_money=!1,t.is_keypad=!1,t.disp_keypad_val="",t.is_distribution=!1,t.on("update",function(){}),t.on("updated",function(){}),this.zeroPadding=function(e,t){return("00"+e).slice(-t)}.bind(this),this.edit_show_column=function(e,i){var a=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);return void 0!==t.houshiki_attr[a]&&t.houshiki_attr[a][i][e]}.bind(this),this.edit_label=function(e){var i=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);return void 0===t.houshiki_attr[i]?"--":t.houshiki_attr[i].label[e]}.bind(this),this.edit_show_input_type=function(e){var i=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);return void 0===t.houshiki_attr[i]?"checkbox":/^radio/.test(t.houshiki_attr[i].check[e])?"radio":"checkbox"}.bind(this),this.edit_line=function(e){var i=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);return void 0!==t.houshiki_attr[i]&&t.houshiki_attr[i].in[e]}.bind(this),this.edit_number_active=function(e,i){"abroad"==t.ipat_syusai&&t.race_horse[i]&&(i=t.race_horse[i].umaban);var a=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);return void 0!==t.houshiki_attr[a]&&(void 0!==t.btn_uno[e]&&!!t.btn_uno[e][i])}.bind(this),this.edit_number_disable=function(e,i){return"abroad"==t.ipat_syusai&&t.race_horse[i]&&(i=t.race_horse[i].umaban),!(void 0===t.btn_uno_disable[e]||!t.btn_uno_disable[e][i])}.bind(this),this.edit_number_disable_waku=function(e,i){var a=t.cur_shikibetu+t.cur_houshiki;t.btn_uno[0]&&"33"==a&&(Object.keys(t.btn_uno[0])[0]==Object.keys(t.waku_horse[i])&&(t.btn_uno_disable[e][i]=!0));return!(void 0===t.btn_uno_disable[e]||!t.btn_uno_disable[e][i])}.bind(this),this.edit_number_all_disable=function(e){var i=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);return void 0===t.houshiki_attr[i]||!t.houshiki_attr[i].all[e]}.bind(this),this.edit_houshiki_button1_disable=function(e){var i=sprintf("%1d%1d",t.cur_shikibetu,e);return void 0!==t.houshiki_attr[i]}.bind(this),this.edit_kaime_label=function(e,i,a){var s=sprintf("%1d%1d",e,i);return void 0!==t.houshiki_attr[s]?t.houshiki_attr[s].label[a]:""}.bind(this),this.edit_combination=function(e,t,i){for(var a=e.split(/-/),s=[],n=0;n<a.length;n++){var o={};o.no=parseInt(a[n]),o.type=6==t||8==t?2:1,n==a.length-1&&(o.type=-1),s.push(o)}return s}.bind(this),this.edit_grade_icon=function(){var e=t.cur_race.grade_cd+t.cur_race.jyoken_cd;return"3"==t.cur_race.track_kubun&&("A"==t.cur_race.grade_cd?e="F"+t.cur_race.jyoken_cd:"B"==t.cur_race.grade_cd?e="G"+t.cur_race.jyoken_cd:"C"==t.cur_race.grade_cd&&(e="H"+t.cur_race.jyoken_cd)),t.cur_race.kaisai_date>="20190601"&&("005"==e?e="1win":"010"==e?e="2win":"016"==e&&(e="3win")),t.grade_icon[e]}.bind(this),this.edit_kaisai_date=function(e){var t=e.substr(4,2),i=e.substr(6,2);return sprintf("%s/%s",t,i)}.bind(this),this.edit_kaime_class=function(e){return 6==e||8==e?"Kaime_Arrow":"Hyphen"}.bind(this),this.edit_check_bet_money=function(e){return e<0?"":e/100}.bind(this),this.edit_payment_diff=function(e,t){return e-t<0?"minus":"plus"}.bind(this),this.number_format=function(e){return isNaN(e)?0:e.toString().replace(/(\d+?)(?=(?:\d{3})+$)/g,function(e){return e+","})}.bind(this),this.act_show_keypad=function(){t.is_keypad=!0}.bind(this),this.act_keypad=function(e){if(isNaN(e)){if("clear"==e)t.disp_keypad_val="";else if("close"==e)t.is_keypad=!1,t.disp_keypad_val="";else if("set"==e){if(t.disp_keypad_val<=0)return t.is_keypad=!1,t.disp_keypad_val="","";t.bet_money=100*t.disp_keypad_val,t.is_keypad=!1,t.disp_keypad_val=""}}else t.disp_keypad_val+=String(e)}.bind(this),this.act_distribution=function(){t.is_distribution?t.is_distribution=!1:t.is_distribution=!0}.bind(this),this.disp_btn_disabled=function(){return t.bet_count>="1"?"btn":"btn disabled"}.bind(this),t.on("mount",function(){t.debug&&console.log("mount %s",t.args.tag_name),t.args.obs.trigger("tag_mounted",{tag:t.args.tag_name})}),t.args.obs.on("render_"+t.args.tag_name,function(e){t.debug&&console.log("render_%s start p: %O",t.args.tag_name,e),t.param=e,t.kaisai_list={},t.race_list={},t.cur_jyo_cd="",t.cur_jyo_name="",t.cur_race_id="",t.cur_race_name="",t.cur_kaisai_date="",t.cur_race={},t.cur_shikibetu=-1,t.cur_houshiki=-1,t.phase=0,t.group_list=[],t.ijyo_list={},t.ijyo_waku_list={},$(window).off("message.childmodal"),$(window).on("message.childmodal",function(e){console.log("message catch childmodal"),console.log("--- origin["+e.originalEvent.origin+"]"),console.log("--- data  ["+e.originalEvent.data+"]"),e.originalEvent.origin+"/"==t.args.race_url&&"child_close"==e.originalEvent.data&&(console.log("--- child_close"),location.reload())}),t.show_data(e)});var i=function(e){return Object.keys(e[0]).map(function(t){return e.map(function(e){return e[t]})})};t.show_data=function(e){t.debug&&console.log("self.show_data"),t.ext_param=e,t.debug&&console.log("self.ext_param: %O",t.ext_param);var i=new IpatDataModel;t.shikibetu=i.get_shikibetu();var a=i.get_houshiki();for(var s in t.houshiki={},a){var n=s.substr(0,1),o=s.substr(1,1);void 0===t.houshiki[n]&&(t.houshiki[n]={}),t.houshiki[n][o]=a[s]}var c=new AplApiRace(t.args.api_url,!0,"json"),r="";if(void 0===e.date)return console.error("empty parameter 'date'"),!1;r=e.date.substr(0,4);var _=e.date;t.isam_domain=sprintf("bet_%s",e.race_id),t.debug&&console.log("self.isam_domain: %s",t.isam_domain),t.syusai="",t.ipat_syusai="",e.race_id.substr(4,2)<="10"?(t.syusai="jra",t.ipat_syusai="jra"):e.race_id.substr(4,2)>"99"?(t.syusai="jra",t.ipat_syusai="abroad"):(t.syusai="nar",t.ipat_syusai="nar"),c.get("AplKaisai",{year:r,syusai:t.syusai},function(i){for(var a=0;a<i.length;a++)if(_==i[a].kaisai_date){t.kaisai_list=i[a];var s=i[a].group_id;break}t.debug&&console.log("self.kaisai_list: %O",t.kaisai_list);for(a=0;a<i.length;a++)s==i[a].group_id&&t.group_list.push(i[a]);t.debug&&console.log("self.group_list: %O",t.group_list),c.get("AplRace",{kaisai_date:_,syusai:t.syusai},function(i){for(var a={},s=0;s<i.length;s++)if(t.race_list[i[s].jyo_cd]=i[s].list,void 0!==e.race_id)for(var n in i[s].list){var o=i[s].list[n];o.race_id==e.race_id&&(a=o)}if(t.debug&&console.log("self.race_list: %O",t.race_list),void 0!==e.race_id){t.debug&&console.log("selected_race: %O",a);var c=a.kaisai_date,r=c.substr(4,2),_=c.substr(6,2);t.cur_kaisai_date=sprintf("%s/%s",r,_),new NDIpatApi(t.args.ipat_url,t.ipat_syusai).check_service(function(e){console.log("data: %O",e),"OK"==e.status&&(t.is_betting=!0),t.act_jyo(a.jyo_cd,a.jyo),t.act_race(a.race_id,a.race_name,a.jyoken)})}else t.update()})})},t.get_shutuba_mark=function(e,i){t.debug&&console.log("self.get_shutuba_mark(%s)",e);var a=new NDCartApi(t.args.cart_url,"json"),s=sprintf("horse_%s",e);a.get_item_list(s,function(e){if("OK"==e.status){var a={};for(var s in e.data){var n=e.data[s]._cd.split(/_/);"0"!=n[1]&&(a[s]=n[1])}t.my_mark=a,t.debug&&console.log("self.my_mark: %O",t.my_mark),void 0!==i&&i()}})},t.change_race_horse=function(e,i){t.debug&&console.log("self.change_race_horse(%s)",e),new AplApiRace(t.args.api_url,!0,"json").get("AplRaceHorse",{race_id:e},function(e){for(var a={},s=0;s<e.length;s++)""==e[s].umaban&&alert("出馬表に馬番がない"),"abroad"!=t.ipat_syusai?a[e[s].umaban]=e[s]:a[e[s].wakuban]=e[s];t.race_horse=a,t.debug&&console.log("self.race_horse: %O",t.race_horse);var n={};for(var o in t.race_horse){var c=t.race_horse[o].wakuban;void 0===n[c]&&(n[c]={}),n[c][t.race_horse[o].umaban]={seq:t.race_horse[o].seq,umaban:t.race_horse[o].umaban,horse_name:t.race_horse[o].horse_name},"取消"!=t.race_horse[o].ijyo&&"除外"!=t.race_horse[o].ijyo||(t.ijyo_list[t.race_horse[o].umaban]=!0,void 0===t.ijyo_waku_list[c]&&(t.ijyo_waku_list[c]={}),t.ijyo_waku_list[c][t.race_horse[o].umaban]=!0)}t.waku_horse=n;var r=Object.keys(t.waku_horse);t.max_waku=r.length,t.debug&&console.log("self.max_waku: %s",t.max_waku),t.debug&&console.log("self.waku_horse: %O",t.waku_horse),t.debug&&console.log("self.ijyo_list: %O",t.ijyo_list),t.debug&&console.log("self.ijyo_waku_list: %O",t.ijyo_waku_list),i()})},t.reset_uno=function(e,i){t.debug&&console.log("self.reset_uno(%s,%s)",e,i),t.btn_uno={};for(var a=0;a<3;a++){(e<0||e>=0&&a==e)&&(t.btn_uno_disable[a]={});for(var s=0;s<=t.max_uma;s++)t.btn_uno_disable[a][s]=1!=i}},t.act_jyo=function(e,i){t.debug&&console.log("self.act_jyo(%s,%s)",e,i),t.cur_jyo_cd=e,t.cur_jyo_name=i,t.cur_race_id="",t.cur_race_name="",t.phase=1},t.act_race=function(e,a,s,n){for(var o in t.debug&&console.log("self.act_race(%s,%s,%s)",e,a,s),void 0!==n&&console.log("self.act_race :%O",n),void 0!==n&&(n.preventUpdate=!0),t.cur_shikibetu=-1,t.cur_houshiki=-1,t.cur_race_id=e,t.cur_race_name=""!=a?a:s,t.race_list[t.cur_jyo_cd]){var c=t.race_list[t.cur_jyo_cd][o];e==c.race_id&&(t.cur_race=t.race_list[t.cur_jyo_cd][o])}t.debug&&console.log("self.cur_race: %O",t.cur_race),t.debug&&console.log("self.max_uma: %s",t.max_uma);var r=new IpatDataModel;t.shikibetu=r.get_shikibetu(),t.change_race_horse(e,function(){if(void 0!==n&&(n.preventUpdate=!1),t.max_uma=t.cur_race.tosu,t.max_uma||"abroad"!=t.ipat_syusai||(t.max_uma=Object.keys(t.race_horse).length),t.max_uma<9||t.cur_race.jyo_cd.substr(0,1)>="A")for(var a in t.shikibetu)"3"==a&&delete t.shikibetu[a];t.data_number=[];for(var s=0;s<3;s++){t.data_number[s]=[];for(var o=1;o<=t.max_uma;o++)t.data_number[s][o]=!0}t.data_number_v=i(t.data_number),t.phase=2,new AplApiRace(t.args.api_url,!0,"json").get("AplRaceOdds",{race_id:e},function(e){for(var i=1;i<=8;i++)if(t.odds[i]={},void 0!==e["list_"+i])for(var a=0;a<e["list_"+i].length;a++){var s=e["list_"+i][a];t.odds[i][s[0]]=[s[1],s[2],s[3]]}else console.error("not found list_%s",i);t.debug&&console.log("self.odds: %O",t.odds),t.render_bet_list(),t.get_shutuba_mark(t.cur_race_id,function(){t.is_show=!0,t.update(),t.get_odds(),t.list_mark_check()})})})},t.act_shikibetu=function(e){t.debug&&console.log("self.act_shikibetu(%s)",e),t.cur_shikibetu=e,t.max_uma="3"==e?t.max_waku:t.cur_race.tosu,t.max_uma||"abroad"!=t.ipat_syusai||(t.max_uma=Object.keys(t.race_horse).length),t.data_number=[];for(var a=0;a<3;a++){t.data_number[a]=[];for(var s=1;s<=t.max_uma;s++)t.data_number[a][s]=!0}t.data_number_v=i(t.data_number),t.btn_func=[0,1,2],t.reset_uno(-1,0),t.bet_select={},t.btn_func_stat={all:[0,0,0],mark:[0,0,0]},t.bet_money=-1,t.bet_count=0,t.phase=3,t.multi_attr=!1,t.multi=!1,t.act_houshiki(0),t.act_houshiki_1(0),t.get_odds()},t.act_houshiki_1=function(e){t.debug&&console.log("self.act_houshiki_1(%s)",e),t.cur_houshiki_1=e,t.act_houshiki(e),t.list_mark_check()},t.act_houshiki=function(e){t.debug&&console.log("self.act_houshiki(%s)",e),t.cur_houshiki=e,t.btn_uno={},t.btn_func_stat={all:[0,0,0],mark:[0,0,0]},t.bet_count=0,t.bet_money=-1,t.phase=4,"6"==t.cur_shikibetu&&("3"==t.cur_houshiki||"4"==t.cur_houshiki)||"8"==t.cur_shikibetu&&("3"==t.cur_houshiki||"4"==t.cur_houshiki||"5"==t.cur_houshiki||"6"==t.cur_houshiki||"7"==t.cur_houshiki||"8"==t.cur_houshiki)?t.multi_attr=!0:t.multi_attr=!1;for(var i=t.houshiki_attr[sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki)].in,a=0;a<3;a++)for(var s=1;s<=t.max_uma;s++)i[a]?t.btn_uno_disable[a][s]=!1:t.btn_uno_disable[a][s]=!0;t.bet_select_all=!1,t.list_mark_check()},t.act_number=function(e,i,a){t.debug&&console.log("self.act_number(%s,%s)",e,i),void 0===t.btn_uno[e]&&(t.btn_uno[e]={}),"abroad"==t.ipat_syusai&&t.race_horse[i]&&(i=t.race_horse[i].umaban),1==t.btn_uno[e][i]?delete t.btn_uno[e][i]:t.btn_uno[e][i]=!0;var s=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);if(void 0!==t.houshiki_attr[s].check){({30:!0,60:!0,70:!0,80:!0,90:!0})[s]&&t.radio_uno(e,i);var n=t.make_bet(100);n<0?t.bet_count=0:Array.isArray(n)?t.bet_count=n.length:t.bet_count=n.bet_count;var o=t.houshiki_attr[s].check[e];if(o){var c=[];o.match(/&/)?c=o.split(/&/):c.push(o);for(var r=0;r<c.length;r++){if(c[r].match(/max:/)){var _=c[r].split(/:/);t.max_uno(e,i,_[1])}"radio"==c[r]&&t.radio_uno(e,i),"nodupp"==c[r]&&t.nodupp_uno(e,i)}}}},t.make_bet=function(e){if(t.debug&&console.log("self.make_bet(%s)",e),e<0)return-1;if(Object.keys(t.btn_uno).length<1)return-2;if(t.check_umaban_selection())return-2;var i=t.cur_houshiki;t.cach_distribution_flag&&(i=0);var a=[],s="";for(var n in t.btn_uno){var o=t.btn_uno[n],c=[];for(var r in o)1==o[r]&&c.push(r);c.length<1||(c.length>1?"1"==t.cur_shikibetu||"2"==t.cur_shikibetu?a.push(c):"0"==i?a.push(c.join("_")):a.push(c.join("-")):a.push(c))}if("7"==t.cur_shikibetu&&"6"==t.cur_houshiki&&a.sort(function(e,t){if(1==e.length&&1==t.length)return parseInt(e)<parseInt(t)?-1:parseInt(e)>parseInt(t)?1:0}),"3"==t.cur_shikibetu&&"0"==t.cur_houshiki){var _={};for(var l in t.waku_horse){Object.keys(t.waku_horse[l]).length>1&&(_[l]=!0)}var u=a[0][0]||0,b=a[1][0]||0;if(!(u!=b||_[u]&&_[b]))return-2}s=a.length>1?a.join("_"):a.join("");var d=[];if((1==t.cur_shikibetu||2==t.cur_shikibetu)&&a[0].length>1&&(d=s.split(",")),("3"==t.cur_shikibetu||"7"==t.cur_shikibetu)&&"0"==i){var h=s.split(/_/);h.sort(function(e,t){return parseInt(e)<parseInt(t)?-1:parseInt(e)>parseInt(t)?1:0}),s=h.join("_")}t.multi&&(s+="_1"),t.debug&&console.log("kaime: %O kaime_id: %s",a,s);var k=sprintf("%s/%s/%s",t.cur_race.kaisai_date.slice(0,4),t.cur_race.kaisai_date.slice(4,6),t.cur_race.kaisai_date.slice(6,8)),m=new Date(k).getDay()+1;if(isNaN(m)){m={"日":1,"月":2,"火":3,"水":4,"木":5,"金":6,"土":7}[t.cur_race.youbi]}if("jra"==t.syusai)"0"==(p=t.cur_race_id.substr(5,1))&&(p="10");else var p=t.cur_race_id.substr(4,2);var f=parseInt(t.cur_race_id.substr(10,2));if(d.length>0){var v=[];for(var n in d){s=d[n];var g=sprintf("a%1s-%1s-%1s_b%1s_c%s_%s",m,p,f,t.cur_shikibetu,t.cur_houshiki,s);v.push(t.bet_gen(g,e)),v[n].open=0}return v}i=t.cur_houshiki;t.cach_distribution_flag&&(i=0);g=sprintf("a%1s-%1s-%1s_b%1s_c%s_%s",m,p,f,t.cur_shikibetu,i,s);return(v=t.bet_gen(g,e)).open=0,v},t.act_ext_func=function(e,i){if(t.debug&&console.log("self.act_ext_func(%s,%s)",e,i),"all"==e){for(var a=1;a<=t.max_uma;a++)t.btn_uno_disable[i][a]||(void 0===t.btn_uno[i]&&(t.btn_uno[i]={}),0==t.btn_func_stat.all[i]?t.btn_uno[i][a]=1:t.btn_uno[i][a]=0);0==t.btn_func_stat.all[i]?(t.btn_func_stat.all[i]=1,t.btn_func_stat.mark[i]=0):t.btn_func_stat.all[i]=0}else if("mark"==e){t.btn_uno[i]={};var s={};if("3"==t.cur_shikibetu){var n={},o={};for(var c in t.race_horse)o[t.race_horse[c].umaban]=t.race_horse[c].seq,n[t.race_horse[c].umaban]=t.race_horse[c].wakuban;for(var r in n)s[n[r]]=0;for(var r in n){var _=o[r];t.my_mark[_]&&"99"!=t.my_mark[_]&&s[n[r]]++}t.debug&&console.log("waku_mark: %O",s)}for(a=1;a<=t.max_uma;a++)if(!t.btn_uno_disable[i][a])if(void 0===t.btn_uno[i]&&(t.btn_uno[i]={}),0==t.btn_func_stat.mark[i])if("3"==t.cur_shikibetu)t.btn_uno[i][a]=s[a]>0;else{o={};for(var c in t.race_horse)o[t.race_horse[c].umaban]=t.race_horse[c].seq;_=o[a];t.my_mark[_]&&"99"!=t.my_mark[_]&&(t.btn_uno[i][a]=!0)}else t.btn_uno[i][a]=!1;0==t.btn_func_stat.mark[i]?(t.btn_func_stat.mark[i]=1,t.btn_func_stat.all[i]=0):t.btn_func_stat.mark[i]=0}else"clear"==e&&(t.btn_uno[i]={},t.btn_func_stat.mark[i]=0,t.btn_func_stat.all[i]=0);var l=t.make_bet(100);l<0?t.bet_count=0:Array.isArray(l)?t.bet_count=l.length:t.bet_count=l.bet_count},t.max_uno=function(e,i,a){if(t.debug&&console.log("self.max_uno(%s,%s,max)",e,i,a),t.count_bet()>a){alert(sprintf("%d頭以上は選択できません。",parseInt(a)+1)),delete t.btn_uno[e][i];var s=t.make_bet(100);s<0?t.bet_count=0:Array.isArray(s)?t.bet_count=s.length:t.bet_count=s.bet_count,t.update(),document.getElementById(sprintf("uc-%d-%d",e,i)).checked=!1}},t.count_bet=function(){var e=0;for(var i in t.btn_uno)for(var a in t.btn_uno[i])e++;return e},t.radio_uno=function(e,i){t.debug&&console.log("self.radio_uno(%s,%s)",e,i);var a=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki),s=-1;if(void 0!==t.btn_uno[e])for(var n=0;n<=t.max_uma;n++)if(n!=i&&t.btn_uno[e][n]){s=n;break}for(var o=0;o<3;o++)t.houshiki_attr[a].in[o]&&(30!=a?(e!=o&&void 0!==t.btn_uno[o]&&t.btn_uno[o][i]&&(delete t.btn_uno[o][i],console.log("delete(current) i: %s uix: %s",o,i)),s>0&&void 0!==t.btn_uno[o]&&t.btn_uno[o][s]&&(delete t.btn_uno[o][s],console.log("delete(before) i: %s b_uix: %s",o,s))):(e!=o&&void 0!==t.btn_uno[o]&&t.btn_uno[o][i],e==o&&s>0&&void 0!==t.btn_uno[o]&&t.btn_uno[o][s]&&(delete t.btn_uno[o][s],console.log("delete(before) i: %s b_uix: %s",o,s))),s>0&&(t.btn_uno_disable[o][s]=!1));console.log("self.btn_uno_disable: %O",t.btn_uno_disable)},t.nodupp_uno=function(e,i){t.debug&&console.log("self.nodupp_uno(%s,%s)",e,i);var a=sprintf("%1d%1d",t.cur_shikibetu,t.cur_houshiki);if(3!=t.cur_shikibetu&&9!=t.cur_shikibetu||(3==t.cur_shikibetu||9==t.cur_shikibetu)&&Object.keys(t.waku_horse[i]).length<=1)for(var s=0;s<3;s++)for(var n=1;n<=t.max_uma;n++)t.houshiki_attr[a].in[s]&&n==i&&(t.btn_uno_disable[s][n]=!0);t.debug&&console.log("self.btn_uno_disable: %O",t.btn_uno_disable)},t.act_multi=function(e){t.debug&&console.log("self.act_multi(%s)",e.target.checked),t.multi=e.target.checked;var i=t.make_bet(100);i<0||(t.bet_count=i.bet_count)},t.act_input_money=function(e){t.debug&&console.log("self.act_input_money(%s)",e.target.value),t.bet_money=100*e.target.value},t.act_change_money_single=function(e){if(t.debug&&console.log("self.act_chenge_money(%O)",e),e){var i=e.item.bet.bet_no,a=e.item.bet.bet_id;t.bet_money=100*e.target.value;var s=t.bet_money/100;(Math.round(s)!==s||s<1)&&alert("\n金額が未入力、あるいは正しくありません。\n"),(new NDIsam).replace(t.isam_domain,i,{bet_id:a,bet_money:t.bet_money}),t.render_bet_list(),t.bet_select={},t.bet_money=-1}else t.is_change_money=!1},t.render_bet_list=function(){t.debug&&console.log("self.render_bet_list"),t.bet_view=[],t.total_bet_money=0;var e=(new NDIsam).list(t.isam_domain);if(!1!==e){for(var i in e){var a=t.bet_gen(e[i].bet_id,e[i].bet_money);if("0"==a.houshiki){var s="";"1"==a.shikibetu||"2"==a.shikibetu?s=sprintf("%02d",a.kaime1):"3"==a.shikibetu||"4"==a.shikibetu||"5"==a.shikibetu||"6"==a.shikibetu?s=sprintf("%02d%02d",a.kaime1,a.kaime2):"7"!=a.shikibetu&&"8"!=a.shikibetu||(s=sprintf("%02d%02d%02d",a.kaime1,a.kaime2,a.kaime3));var n=0;if(void 0===t.odds[a.shikibetu])t.debug&&console.error("empty odds shikibetu: %s",a.shikibetu);else if(void 0===t.odds[a.shikibetu][s])t.debug&&console.error("unkown key : %s",s),n=0;else{n=t.odds[a.shikibetu][s][0]*a.bet_money;n=Math.round(n)}a.payback=n}else{a.payback=[];for(var o=0;o<a.comb.length;o++){for(var c=a.comb[o].split(/-/),r=(s="",0);r<c.length;r++)s+=sprintf("%02d",c[r]);void 0===t.odds[a.shikibetu]?t.debug&&console.error("empty odds shikibetu: %s",a.shikibetu):void 0===t.odds[a.shikibetu][s]?(t.debug&&console.error("unkown key : %s",s),n=0):(n=t.odds[a.shikibetu][s][0]*a.bet_money,n=Math.round(n)),t.debug&&console.log("payback: %s:",n),a.payback.push(n)}}a.bet_no=i,a.open=0,t.bet_view.push(a),t.total_bet_money+=parseInt(a.bet_money_total)}t.debug&&console.log("self.total_bet_money: %s",t.total_bet_money),t.debug&&console.log("self.bet_view: %O",t.bet_view)}else console.error("isam empty..")},t.check_umaban_selection=function(){t.debug&&console.log("self.check_umaban_selection");var e=[0,0,0],i={};for(var a in t.btn_uno){var s=t.btn_uno[a];for(var n in s){if(3==t.cur_shikibetu||9==t.cur_shikibetu){if(t.ijyo_waku_list[n]){if(Object.keys(t.waku_horse[n]).length<=Object.keys(t.ijyo_waku_list[n]).length){delete t.btn_uno[a][n];continue}0==a?i[1]=n:1==a&&(i[0]=n)}}else if(t.ijyo_list[n]){delete t.btn_uno[a][n];continue}1==s[n]&&e[a]++}}if(3==t.cur_shikibetu||9==t.cur_shikibetu)if(Object.keys(i).length>=1)for(var a in i)t.btn_uno_disable[a][i[a]]=!0;else for(a=0;a<3;a++)for(var o=1;o<=t.max_uma;o++)t.btn_uno_disable[a][o]=!1;var c=t.cur_houshiki;t.cach_distribution_flag&&(c=0);var r=sprintf("%1d%1d",t.cur_shikibetu,c);t.debug&&console.log("umaban_num: %O",e),t.debug&&console.log("key: %s",r);var _=t.houshiki_check[r].chk,l=!1;for(a=0;a<_.length;a++){var u=_[a].split(/:/);"eq"==u[0]?e[a]!=u[1]&&(l=!0):"gt"==u[0]&&e[a]<u[1]&&(l=!0)}return t.debug&&console.log("err: %s",l),l},t.act_add_bet=function(e){t.debug&&console.log("self.act_add_bet()");var i=t.bet_money/100;if(Math.round(i)!==i||i<1)return alert("\n金額が未入力、あるいは正しくありません。\n"),!1;t.cach_distribution_flag=!1;var a=t.make_bet(t.bet_money);if(t.is_distribution&&t.cach_distribution(a,function(e){a=e}),-1==a)return alert("\n金額が未入力、あるいは正しくありません。\n"),!1;if(-2==a)return alert("\n馬番が正しく、選択されていません。\n"),!1;if(!Array.isArray(a)){if(a.bet_count<1)return alert("\n組み合わせがありません。\n"),!1;if(a.bet_money<=0)return alert("\n金額が未入力、あるいは正しくありません。\n"),!1}t.phase=5;var s=new NDIsam;if(Array.isArray(a))new Promise(function(e,i){!function i(n){return new Promise(function(e,i){var o=sprintf("%s_%s",t.cur_race_id,CybozuLabs.MD5.calc(Date.now()));a[n].bet_no=o,s.replace(t.isam_domain,o,{bet_id:a[n].bet_id,bet_money:a[n].bet_money}),setTimeout(function(){t.bet_view.push(a[n]),e(n+1)},10)}).then(function(t){t>=a.length?e():i(t)})}(0)}).then(function(){t.reset_uno(-1,1),t.bet_select={},t.bet_select_all=!1,t.bet_money=-1,t.btn_func_stat={all:[0,0,0],mark:[0,0,0]},"6"==t.cur_shikibetu&&("3"==t.cur_houshiki||"4"==t.cur_houshiki)||"8"==t.cur_shikibetu&&("3"==t.cur_houshiki||"4"==t.cur_houshiki||"5"==t.cur_houshiki||"6"==t.cur_houshiki||"7"==t.cur_houshiki||"8"==t.cur_houshiki)?t.multi_attr=!0:t.multi_attr=!1,t.multi=!1,t.bet_count=0,t.is_distribution=!1,t.cach_distribution_flag=!1,t.render_bet_list(),t.update()});else{var n=sprintf("%s_%s",t.cur_race_id,CybozuLabs.MD5.calc(Date.now()));a.bet_no=n,s.replace(t.isam_domain,n,{bet_id:a.bet_id,bet_money:t.bet_money}),t.bet_view.push(a),t.reset_uno(-1,1),t.bet_select={},t.bet_select_all=!1,t.bet_money=-1,t.btn_func_stat={all:[0,0,0],mark:[0,0,0]},"6"==t.cur_shikibetu&&("3"==t.cur_houshiki||"4"==t.cur_houshiki)||"8"==t.cur_shikibetu&&("3"==t.cur_houshiki||"4"==t.cur_houshiki||"5"==t.cur_houshiki||"6"==t.cur_houshiki||"7"==t.cur_houshiki||"8"==t.cur_houshiki)?t.multi_attr=!0:t.multi_attr=!1,t.multi=!1,t.bet_count=0,t.cach_distribution_flag=!1,t.is_distribution=!1,t.render_bet_list()}},t.bet_gen=function(e,i){if(t.debug&&console.log("self.bet_gen(%s,%s)",e,i),void 0===e)return{};var a=e.split(/_/),s=(a[1].substr(1,1),a[1].substr(1,1)+a[2].substr(1,1)),n=new IpatDataModel,o=[],c=[];for(var r in t.waku_horse){Object.keys(t.waku_horse[r]).length>1&&c.push(r)}t.debug&&console.log("waku_check: %O",c),o=n.cvt_bet(e,i,c);var _=a[0].split(/-/);if(o.race_name=sprintf("%s %02dR",{1:"札幌",2:"函館",3:"福島",4:"新潟",5:"東京",6:"中山",7:"中京",8:"京都",9:"阪神",a:"小倉"}[_[1]],_[2]),"0"==s.substr(1,1)){var l="";"1"==o.shikibetu||"2"==o.shikibetu?l=sprintf("%02d",o.kaime1):"3"==o.shikibetu||"4"==o.shikibetu||"5"==o.shikibetu||"6"==o.shikibetu?l=sprintf("%02d-%02d",o.kaime1,o.kaime2):"7"!=o.shikibetu&&"8"!=o.shikibetu||(l=sprintf("%02d-%02d-%02d",o.kaime1,o.kaime2,o.kaime3)),o.kumi_name=l}o.ary_kaime=[];for(var u=1;u<=3;u++)if(""!=o["kaime"+u]){var b=o["kaime"+u].split(/-/);o.ary_kaime.push(b)}return o},t.act_kaime_open=function(e){t.debug&&console.log("self.act_kaime_open(%s)",e),t.bet_view[e].open?t.bet_view[e].open=0:t.bet_view[e].open=1},t.act_kaime_select=function(e,i){t.debug&&console.log("self.act_kaime_select(%s,%s)",e,i);var a="c";if(i<0&&(a="p",i=0),t.bet_select[1e3*e+i])delete t.bet_select[1e3*e+i];else{for(var s in t.bet_select){var n=Math.floor(s/1e3),o=Math.floor(s%1e3);if(console.error("p: %s c: %s",n,o),"c"==a){if(e==n)continue;delete t.bet_select[s]}"p"==a&&0!=o&&delete t.bet_select[s]}if("c"==a){n=Math.floor(i/1e3);delete t.bet_select[1e3*(n+1)]}t.bet_select[1e3*e+i]=!0}t.debug&&console.log("self.bet_select: %O",t.bet_select)},t.act_kaime_select_all=function(){if(t.debug&&console.log("self.act_kaime_select_all()"),!1===t.bet_select_all){t.bet_select_all=!0;for(var e=0;e<t.bet_view.length;e++)t.bet_select[1e3*e]=!0}else t.bet_select_all=!1,t.bet_select={};t.debug&&console.log("self.bet_select: %O",t.bet_select)},t.act_change_money=function(e){if(t.debug&&console.log("self.act_change_money(%s)",e),e){var i=t.bet_money/100;if(Math.round(i)!==i||i<1)return alert("\n金額が未入力、あるいは正しくありません。\n"),!1;var a=0,s=0;for(var n in t.bet_select){var o=Math.floor(n/1e3);0==Math.floor(n%1e3)?s++:a++}if(t.debug&&console.log("p: %s c: %s",s,a),s>0){var c=new NDIsam;for(var n in t.bet_select){o=Math.floor(n/1e3);var r={bet_id:t.bet_view[o].bet_id,bet_money:t.bet_money};c.replace(t.isam_domain,t.bet_view[o].bet_no,r)}t.render_bet_list(),t.bet_select={},t.bet_money=-1}else a>0&&confirm("\n買い目が展開されますが、よろしいですか？\n")&&(t.change_money_bet_child(),t.render_bet_list(),t.bet_select={},t.bet_money=-1)}t.is_change_money=!1},t.act_kaime_delete=function(){t.debug&&console.log("self.act_kaime_delete()");var e=0,i=0;for(var a in t.bet_select){var s=Math.floor(a/1e3);0==Math.floor(a%1e3)?i++:e++}if(t.debug&&console.log("p: %s c: %s",i,e),i>0){if(confirm("\n本当に削除してもよろしいですか？\n")){var n=new NDIsam;for(var a in t.bet_select){s=Math.floor(a/1e3);n.remove(t.isam_domain,t.bet_view[s].bet_no)}t.render_bet_list(),t.bet_select={}}}else e>0&&confirm("\n本当に削除してもよろしいですか？\n")&&(t.delete_bet_child(),t.render_bet_list(),t.bet_select={})},t.act_check_bet_select=function(){t.debug&&console.log("self.act_check_bet_select"),Object.keys(t.bet_select).length<=0?alert("買い目を選択してください"):(t.height=$("body").height(),t.width=$("body").width(),t.is_change_money=!0)},t.delete_bet_child=function(){t.debug&&console.log("self.delete_bet_child");var e={},i=-1;for(var a in t.bet_select){i=Math.floor(a/1e3),e[Math.floor(a%1e3)-1]=!0}t.debug&&console.log("del_c: %O",e);for(var s=[],n=0;n<t.bet_view[i].comb.length;n++){var o=t.bet_view[i].comb[n];t.debug&&console.log("kaime: %s",o),e[n]||s.push(o)}t.debug&&console.log("add_c: %O",s);var c=t.bet_view[i].bet_id.split(/_/);t.debug&&console.log("part: %O",c);var r=[c[0],c[1],""],_=t.bet_view[i].bet_no;t.debug&&console.log("del_bet_no: %s",_),r[2]="c0";var l=new NDIsam;l.remove(t.isam_domain,_);for(n=0;n<s.length;n++){for(var u=s[n].split(/-/),b=0;b<u.length;b++)u[b]=parseInt(u[b]);r[3]=u.join("_");var d=r.join("_");t.debug&&console.log("bet_id: %s",d);var h=Date.now()+n;t.debug&&console.log("str_rand: %s",h);var k=sprintf("%s_%s",t.cur_race_id,CybozuLabs.MD5.calc(h)),m=t.bet_view[i].bet_money;l.replace(t.isam_domain,k,{bet_id:d,bet_money:m})}},t.change_money_bet_child=function(){t.debug&&console.log("self.change_money_bet_child"),t.debug&&console.log("self.bet_select: %O",t.bet_select);var e={},i=-1;for(var a in t.bet_select){i=Math.floor(a/1e3),e[Math.floor(a%1e3)-1]=!0}t.debug&&console.log("del_c: %O p_id: %s",e,i);for(var s={},n=0;n<t.bet_view[i].comb.length;n++){var o=t.bet_view[i].comb[n];t.debug&&console.log("kaime: %s",o),e[n]?s[o]=t.bet_money:s[o]=t.bet_view[i].bet_money}t.debug&&console.log("add_c: %O",s);var c=t.bet_view[i].bet_id.split(/_/);t.debug&&console.log("part: %O",c);var r=[c[0],c[1],""],_=t.bet_view[i].bet_no;t.debug&&console.log("del_bet_no: %s",_),r[2]="c0";var l=new NDIsam;l.remove(t.isam_domain,_),console.error(s);n=0;for(var a in s){for(var u=a.split(/-/),b=0;b<u.length;b++)u[b]=parseInt(u[b]);r[3]=u.join("_");var d=r.join("_");t.debug&&console.log("bet_id: %s",d);var h=Date.now()+n;t.debug&&console.log("str_rand: %s",h);var k=sprintf("%s_%s",t.cur_race_id,CybozuLabs.MD5.calc(h));console.error("bet_no: ",k);var m=s[a];t.debug&&console.log("bet_id: %s bet_money: %s bet_no: %s",d,m,k),l.replace(t.isam_domain,k,{bet_id:d,bet_money:m}),n++}},t.act_bet_complete=function(){if(t.debug&&console.log("self.act_bet_complete"),!(t.total_bet_money<=1e4))return alert("\n\n合計金額が10,000円を越えています。\n\n"),!1;if(console.log("self.ext_param: %O",t.ext_param),void 0!==t.ext_param.return_url){var e=decodeURIComponent(t.ext_param.return_url);window.location.href=e}},t.act_bet_cancel=function(){t.debug&&console.log("self.act_bet_cancel");var e="/bet/shutuba.html?race_id="+t.cur_race_id;console.log(e),window.location.href=e},t.act_jra_ipat_login=function(e){if(console.log("self.act_ipat_login"),"bet"==e){var i=(new NDIsam).list(t.isam_domain),a=Object.keys(i).length;if(a>50)return alert("1度の投票は50件までです"),!1;if(a<=0)return alert("買い目が入力されていません"),!1;for(var s in i)if(!i[s].bet_money||i[s].bet_money<100)return alert("金額が正しく入力されていません"),!1}var n=sprintf("jraipat.html?race_id=%s&action=%s",t.cur_race_id,e);return console.log("url:",n),t.ipat_syusai,void("bet"==e?t.abroad_bet(n,i):window.open(n,"_blank"))},t.abroad_bet=function(e,i){window.open(e,"_blank");var a=sprintf("%sipat/ipat_confirm.html?race_id=%s",t.args.race_url,t.cur_race_id);console.log("location_url : ",a);var s=[];if(!1!==i)for(var n in i)s.push({bet_id:i[n].bet_id,money:i[n].bet_money});var o="bet_"+t.cur_race_id;new NDCartApi(t.args.cart_url).clear_item(o,function(e){console.log("clear_item : ",e);var i=[],n=[],c=[],r=[];for(var _ in s)i.push(s[_].bet_id),n.push(1),c.push(s[_].money),r.push("");$.ajax({url:t.args.cart_url,type:"post",dataType:"json",data:{action:"add",group:o,item_id:i,item_value:n,item_price:c,client_data:r},success:function(e){window.location.href=a},error:function(e,t,i){console.error("XMLHttpRequest.status: ",e.status),console.error("textStatus: ",t),console.error("errorThrown.message: ",i.message)}})})},t.get_odds=function(){if("abroad"==t.ipat_syusai)return!1;$.oddsUpdate({apiUrl:"/api/api_get_jra_odds.html",raceId:t.cur_race_id,isPremium:1,displayDiffTime:!1,PremiumLinkReturnUrl:t.args.race_url+"/?pid=shutuba&race_id&"+t.cur_race_id,PremiumLinkReturnRf:"shutuba",isBrackets:!1,compress:!0,apl:!0,callbackApiComplete:function(e,i,a){"yoso"==i&&(t.is_yoso_odds=!0),$('[id^="odds-1_"]').each(function(){if($(this).removeClass("Odds_Ninki"),$(this).text()<10&&$(this).addClass("Odds_Ninki"),$(this).text()<0){var e=$(this).attr("id").split("_")[1];$(this).removeClass("Odds_Ninki"),$("#odds-1_"+e).html("取消"),$("#ninki-1_"+e).remove(),$(this).next("br").remove(),$(this).next("span").remove()}}),t.update()}})},t.cach_distribution=function(e,i){var a=0,s=[];if(t.cach_distribution_flag=!0,e.comb){for(var n in e.comb){var o=e.comb[n].replace(/-/g,"");a+=1/(c=t.odds[e.shikibetu][o][0])}for(var n in e.comb){o=e.comb[n].replace(/-/g,"");var c=t.odds[e.shikibetu][o][0];b=(b=parseInt(t.bet_money)/(a*c))<100?1:Math.ceil(b/100),b=100*Math.round(b);var r=e.comb[n].split("-");t.btn_uno={};for(var _={},l=0;l<r.length;l++){var u=r[l].replace(/^0/,"");"3"==e.shikibetu||"6"==e.shikibetu||"7"==e.shikibetu||"8"==e.shikibetu?(t.btn_uno[l]={},t.btn_uno[l][u]=!0):_[u]=!0}Object.keys(_).length>0&&(t.btn_uno[0]=_),s.push(t.make_bet(b))}}else if(Array.isArray(e)){for(var n in e){o=e[n].kumi_name;a+=1/(c=t.odds[e[n].shikibetu][o][0])}for(var n in e){var b;o=e[n].kumi_name,c=t.odds[e[n].shikibetu][o][0];b=(b=parseInt(t.bet_money)/(a*c))<100?1:Math.ceil(b/100),b=100*Math.round(b);u=e[n].kaime1;t.btn_uno={},t.btn_uno[0]={},t.btn_uno[0][u]=!0,s.push(t.make_bet(b))}}else s=e;i(s)},t.list_mark_check=function(){$(".RaceOdds_HorseList_Table tbody tr").each(function(){$(this).find(".MarkIcon").length&&$(this).addClass("selected")})}});